---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import BlogPost from '../components/BlogPost.astro';

export async function getStaticPaths() {
  const pages = await getCollection('pages');
  return pages.map((page) => ({
    params: { slug: page.id.replace('.md', '') },
    props: { page }
  }));
}

const { page } = Astro.props;
const { Content } = await page.render();

// Convert slug to title: "test-local-post" -> "Test Local Post"
function slugToTitle(slug: string): string {
  return slug
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}

// Only fetch posts if we're on the writing page
const posts = page.id === 'writing.md' 
  ? await getCollection('writing')
  : [];
---

<Layout title={page.data.title}>
  <Content />
  {posts.length > 0 && (
    <div class="posts">
      {posts.map((post) => (
        <BlogPost
          title={slugToTitle(post.slug)}
          url={`/writing/${post.slug}`}
          pubDate={post.data.pubDate}
          description={post.data.description}
        />
      ))}
    </div>
  )}
</Layout>